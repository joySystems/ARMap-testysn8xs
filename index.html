<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
        <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.5/aframe/build/aframe-ar.js"></script>
        <title>AR erevan</title>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            embedded
            loading-screen="enabled: true;"
            arjs="sourceType: webcam; debugUIEnabled: true;"
        >
                

            <a-camera gps-camera rotation-reader></a-camera>
        </a-scene>

        <script type="text/javascript">
var places = {
  "Place 1": {
    "latitude": 40.221128, 
    "longitude": 44.486834,
    "placed": false
  },
  "Place 2": {
    "latitude": 40.219680, 
    "longitude": 44.487404,
    "placed": false
  },
  
  "Place 3": {
    "latitude": 40.218744, 
    "longitude": 44.488541,
    "placed": false
  },
  
};

function getDistance(lat1, lon1, lat2, lon2) {
  var R = 6371; // Radius of the earth in km
  var dLat = deg2rad(lat2 - lat1); // deg2rad below
  var dLon = deg2rad(lon2 - lon1);
  var a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  var d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI / 180);
}


var watchId = navigator.geolocation.watchPosition(function(position) {
  var userLatitude = position.coords.latitude;
  var userLongitude = position.coords.longitude;

  for (var place in places) {
  if (getDistance(
    userLatitude, userLongitude, places[place].latitude, places[place].longitude
  ) <= 0.2 && places[place].placed == false) { // If user is within 500 meters of Geo point
    var model = document.createElement("a-entity");
    model.setAttribute("gltf-model", "url(assets/Astronaut.glb)");
    model.setAttribute("gps-entity-place", `latitude: ${places[place].latitude}; longitude: ${places[place].longitude};`);
    model.setAttribute("scale", "0.5 0.5 0.5");
    scene.appendChild(model);
    places[place].placed = true;

  }
}


  
});





        </script>
    </body>
</html>
